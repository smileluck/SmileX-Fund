# 移除mockData并使用LocalStorage存储数据

## 一、实施计划

### 1. 创建数据持久化服务
- 创建 `lib/dataService.ts` 文件，实现数据持久化逻辑
- 实现LocalStorage存储和读取功能
- 为后续云端同步预留接口

### 2. 重构数据结构
- 保留原有的接口定义
- 分离用户数据（持仓、钱包）和市场数据
- 实现数据初始化和迁移逻辑

### 3. 替换mockData使用
- 修改 `app/page.tsx` 中的数据获取逻辑
- 替换所有 `fundMockService` 引用
- 实现数据的本地存储和读取

### 4. 实现数据同步
- 监听数据变化并自动保存到LocalStorage
- 实现页面刷新后的数据恢复
- 确保数据一致性

### 5. 保留市场数据功能
- 对于市场指数、贵金属等实时数据，可以继续使用模拟逻辑
- 或考虑从API获取真实数据

### 6. 测试和验证
- 测试数据的存储和读取功能
- 验证页面刷新后数据的一致性
- 测试各种操作（添加、删除、编辑持仓）后的数据状态

## 二、技术实现细节

### 1. 数据存储结构
- `localStorage` 键值设计：
  - `smilex-fund:userHoldings` - 用户持仓数据
  - `smilex-fund:wallets` - 钱包数据
  - `smilex-fund:settings` - 应用设置

### 2. 数据服务API
- `getDataService()` - 获取数据服务实例
- `getUserHoldings()` - 获取用户持仓
- `saveUserHoldings()` - 保存用户持仓
- `getWallets()` - 获取钱包列表
- `saveWallets()` - 保存钱包列表
- `getMarketData()` - 获取市场数据（模拟或真实）

### 3. 性能优化
- 使用防抖（debounce）处理频繁的数据写入
- 实现数据缓存，减少LocalStorage读取次数
- 考虑使用 `sessionStorage` 缓存临时数据

### 4. 错误处理
- 实现LocalStorage存储失败的容错处理
- 提供数据备份和恢复机制
- 处理存储容量限制

## 三、后续云端同步扩展

### 1. 接口预留
- 在数据服务中预留云端同步接口
- 设计数据同步策略（增量同步/全量同步）

### 2. 数据结构设计
- 为每条数据添加唯一标识
- 实现数据版本控制
- 设计冲突解决机制

### 3. 认证和安全
- 预留用户认证接口
- 实现数据加密传输
- 设计权限控制机制

## 四、实施步骤

1. **创建数据服务** - 实现LocalStorage存储逻辑
2. **重构主页面** - 替换mockData引用
3. **测试功能** - 验证数据存储和读取
4. **优化性能** - 实现防抖和缓存
5. **预留扩展** - 为云端同步做准备

## 五、预期效果

- 用户数据（持仓、钱包）持久化存储
- 页面刷新后数据不丢失
- 操作响应速度快
- 为后续云端同步提供基础架构
- 保持现有功能的完整性